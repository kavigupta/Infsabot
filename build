#!/usr/bin/python3

import sys
from os import rename, system
from subprocess import call

args = list(sys.argv)[1:]

PROFILING = "-prof" in args

system("ghc Infsabot/Build.hs -O2 -rtsopts -outputdir bin -main-is Infsabot.Build")

if PROFILING:
    system("ghc Infsabot/Build.hs -O2 -osuf p_o -prof -auto -auto-all -rtsopts -outputdir bin -main-is Infsabot.Build")

try:
    system("rm -r bin")
    system("mkdir bin")
    rename("Infsabot/Build", "bin/Build")
except Exception as e:
    print ("BUILD FAILED")

if PROFILING:
    args.remove("-prof")
    args += ["+RTS", "-xc", "-p", "-RTS"]

call(["./bin/Build"] + args)
